<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">

  <!-- PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#b23a2c">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="BDE PSH">

  <link rel="manifest" href="/BDE-PSH-SUP/public/manifest-public.json">
  <title>BDE PSH SUP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon" href="/BDE-PSH-SUP/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/BDE-PSH-SUP/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/BDE-PSH-SUP/icons/icon-512.png">
</head>
<body>

<header class="header">
  <h1>BDE PSH SUP</h1>
  <p>Actualit√©s & √©v√©nements √©tudiants</p>
</header>

<main class="admin-grid">

  <button id="installBtn" class="btn-primary" style="display:none;">
    üì≤ Installer l‚Äôapplication
  </button>

  <button id="notifBtn" class="btn-primary">
    üîî Activer les notifications
  </button>

</main>

<script>
/* ===============================
   üîó SUPABASE
=============================== */
const supabaseUrl = "https://yswqdhoscahtylemhipt.supabase.co";
const supabaseKey = "TA_CLE_ANON";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

/* ===============================
   üîî NOTIFICATIONS
=============================== */
const notifBtn = document.getElementById("notifBtn");

notifBtn.addEventListener("click", async () => {
  if (!("serviceWorker" in navigator)) {
    alert("Service Worker non support√©");
    return;
  }

  const permission = await Notification.requestPermission();
  if (permission !== "granted") {
    alert("Notifications refus√©es ‚ùå");
    return;
  }

  const registration = await navigator.serviceWorker.ready;

  const vapidPublicKey = "BGflyhuu28Pgue8ZjnLIJLBjm3cVStbDHU2DQ08Khw_LuduY10nBOTlidcFnVZ7jRvm8IZQexMeS1Ip3NSofi6U";

  const subscription = await registration.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey: vapidPublicKey
  });

  const { error } = await supabaseClient
    .from("push_subscriptions")
    .insert([{ subscription }]);

  if (error) {
    console.error(error);
    alert("‚ùå Erreur enregistrement notification");
  } else {
    alert("üîî Notifications activ√©es !");
  }
});
</script>

</body>
</html>
